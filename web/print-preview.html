<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Funbookies - Print Preview</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Nunito', sans-serif;
      background: #2a2a2a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .controls {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    select, button {
      padding: 10px 20px;
      font-size: 1rem;
      font-family: inherit;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    select { background: white; }

    button {
      background: #667eea;
      color: white;
      font-weight: 600;
    }
    button:hover { background: #5a6fd6; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }

    .page-info {
      color: white;
      font-size: 1rem;
      min-width: 120px;
      text-align: center;
    }

    /* Page container - 10x10cm square */
    .page-container {
      width: 400px;
      height: 400px;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
    }

    /* IMAGE AREA - top 70% */
    .image-area {
      flex: 7;
      background: #eee;
      position: relative;
      overflow: hidden;
    }

    .image-area img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* TEXT AREA - bottom 30% */
    .text-area {
      flex: 3;
      background: #FFFFFF;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      border-top: 3px solid #FFB347;
    }

    .text-area p {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      text-align: center;
      line-height: 1.3;
    }

    /* COVER PAGE - title at bottom */
    .page-cover .image-area {
      flex: 7;
    }
    .page-cover .text-area {
      flex: 3;
      background: #FFF8DC;
      border-top: 4px solid #FF6B35;
    }
    .page-cover .text-area p {
      font-size: 24px;
      font-weight: 900;
      color: #FF6B35;
    }

    /* WORD LIST PAGE - no image, just table */
    .page-wordlist {
      background: #FFFEF5;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }

    .page-wordlist h2 {
      text-align: center;
      font-size: 20px;
      font-weight: 800;
      color: #333;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #ddd;
    }

    /* Word list TABLE */
    .word-table {
      flex: 1;
      display: table;
      width: 100%;
      border-collapse: collapse;
    }

    .word-row {
      display: table-row;
    }

    .word-label {
      display: table-cell;
      width: 90px;
      padding: 8px 10px;
      font-size: 10px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      vertical-align: top;
      border-bottom: 1px solid #eee;
    }

    .word-label.sound-out { color: #1565C0; }
    .word-label.sight { color: #7B1FA2; }
    .word-label.new { color: #E65100; }

    .word-cells {
      display: table-cell;
      padding: 8px 10px;
      font-size: 15px;
      font-weight: 600;
      color: #333;
      vertical-align: top;
      border-bottom: 1px solid #eee;
      line-height: 1.6;
    }

    /* END PAGE */
    .page-end .text-area {
      background: #f5f5f5;
      border-top: 3px solid #999;
    }
    .page-end .text-area p {
      font-size: 22px;
      font-weight: 800;
      color: #666;
      font-style: italic;
    }

    /* Thumbnails */
    .thumbnails {
      display: flex;
      gap: 6px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 800px;
    }

    .thumb {
      width: 45px;
      height: 45px;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s, transform 0.2s;
      position: relative;
      background: #ddd;
    }
    .thumb:hover { transform: scale(1.1); }
    .thumb.active { border-color: #667eea; }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .thumb .num {
      position: absolute;
      bottom: 1px;
      right: 1px;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 8px;
      padding: 1px 3px;
      border-radius: 2px;
    }

    .hint {
      color: #888;
      font-size: 0.85rem;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <select id="bookSelect" onchange="loadBook(this.value)">
      <option value="volcano_curated">Gus and the Volcano</option>
    </select>
    <button onclick="prevPage()" id="prevBtn">← Prev</button>
    <div class="page-info" id="pageInfo">Page 1 / 19</div>
    <button onclick="nextPage()" id="nextBtn">Next →</button>
  </div>

  <div class="page-container" id="pageContainer"></div>

  <div class="thumbnails" id="thumbnails"></div>

  <div class="hint">Use ← → arrow keys to navigate</div>

  <script>
    let currentBook = null;
    let currentPage = 0;

    async function loadBook(bookKey) {
      try {
        const res = await fetch(`/books/${bookKey}.json`);
        if (res.ok) {
          currentBook = await res.json();
          currentBook.key = bookKey;
          currentPage = 0;
          renderPage();
          renderThumbnails();
        }
      } catch (e) {
        console.error('Failed to load book:', e);
      }
    }

    function renderPage() {
      if (!currentBook) return;

      const page = currentBook.pages[currentPage];
      const container = document.getElementById('pageContainer');
      const imgPath = page.image ? `/books/images/${page.image}` : null;

      // WORD LIST PAGE - table format
      if (page.type === 'wordlist') {
        const wl = currentBook.word_list;
        container.innerHTML = `
          <div class="page-wordlist" style="width:100%;height:100%;">
            <h2>Words to Know</h2>
            <div class="word-table">
              <div class="word-row">
                <div class="word-label sound-out">Sound-out</div>
                <div class="word-cells">${(wl.sound_out || []).join('   ')}</div>
              </div>
              <div class="word-row">
                <div class="word-label sight">Sight</div>
                <div class="word-cells">${(wl.sight || []).join('   ')}</div>
              </div>
              <div class="word-row">
                <div class="word-label new">New</div>
                <div class="word-cells">${(wl.new || []).join('   ')}</div>
              </div>
            </div>
          </div>
        `;
      }
      // COVER PAGE
      else if (page.type === 'cover') {
        container.innerHTML = `
          <div class="page-cover" style="display:flex;flex-direction:column;width:100%;height:100%;">
            <div class="image-area">
              <img src="${imgPath}" alt="">
            </div>
            <div class="text-area">
              <p>${page.text}</p>
            </div>
          </div>
        `;
      }
      // END PAGE
      else if (page.type === 'end') {
        container.innerHTML = `
          <div class="page-end" style="display:flex;flex-direction:column;width:100%;height:100%;">
            <div class="image-area">
              <img src="${imgPath}" alt="">
            </div>
            <div class="text-area">
              <p>${page.text}</p>
            </div>
          </div>
        `;
      }
      // STORY PAGES - image top, text bottom
      else {
        const displayText = page.text.replace(/\n/g, '<br>');
        container.innerHTML = `
          <div style="display:flex;flex-direction:column;width:100%;height:100%;">
            <div class="image-area">
              <img src="${imgPath}" alt="">
            </div>
            <div class="text-area">
              <p>${displayText}</p>
            </div>
          </div>
        `;
      }

      // Update controls
      document.getElementById('pageInfo').textContent = `Page ${currentPage + 1} / ${currentBook.pages.length}`;
      document.getElementById('prevBtn').disabled = currentPage === 0;
      document.getElementById('nextBtn').disabled = currentPage === currentBook.pages.length - 1;

      // Update thumbnail active state
      document.querySelectorAll('.thumb').forEach((t, i) => {
        t.classList.toggle('active', i === currentPage);
      });
    }

    function renderThumbnails() {
      if (!currentBook) return;

      const container = document.getElementById('thumbnails');
      container.innerHTML = currentBook.pages.map((page, i) => {
        const imgPath = page.image ? `/books/images/${page.image}` : '';
        const bgStyle = page.type === 'wordlist' ? 'background:#FFFEF5;' : '';
        return `
          <div class="thumb ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})" style="${bgStyle}">
            ${imgPath ? `<img src="${imgPath}" alt="">` : '<span style="font-size:8px;color:#666;">LIST</span>'}
            <span class="num">${i + 1}</span>
          </div>
        `;
      }).join('');
    }

    function goToPage(index) {
      currentPage = index;
      renderPage();
    }

    function prevPage() {
      if (currentPage > 0) {
        currentPage--;
        renderPage();
      }
    }

    function nextPage() {
      if (currentBook && currentPage < currentBook.pages.length - 1) {
        currentPage++;
        renderPage();
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prevPage();
      if (e.key === 'ArrowRight') nextPage();
    });

    loadBook('volcano_curated');
  </script>
</body>
</html>
